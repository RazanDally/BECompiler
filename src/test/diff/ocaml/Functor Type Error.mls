(*This benchmark tests the algorithm's ability to handle functors and detect a type error when a functor is applied to a module with an incompatible type*)

module type PRINTABLE = sig
  type t
  val print : t -> unit
end ;;
//│ /!\ Parse error: Expected "=":3:3, found "val print " at l.5:3:   val print : t -> unit

module PrintableInt = struct
  type t = int
  let print x = print_int x
end ;;
//│ Defined type alias t
//│ [ERROR] Type `err` does not match `err -> _`
//│ 
//│	(err) ---> (err -> _)
//│ 
//│ ◉ (err) comes from
//│ │  - l.8  module PrintableInt = struct
//││         ^^^^^^
//│ ▼ 
//│ ◉ (err -> _) comes from
//│    - l.8  module PrintableInt = struct
//│          ^^^^^^
//│ ╔══[ERROR] identifier not found: module
//│ ║  
//│ ║  l.8:	module PrintableInt = struct
//│ ╙──    	^^^^^^
//│ ╔══[ERROR] identifier not found: PrintableInt
//│ ║  
//│ ║  l.8:	module PrintableInt = struct
//│ ╙──    	       ^^^^^^^^^^^^
//│ ╔══[ERROR] identifier not found: struct
//│ ║  
//│ ║  l.8:	module PrintableInt = struct
//│ ╙──    	                      ^^^^^^
//│ res: bool
//│ print: int -> unit
//│ ╔══[ERROR] identifier not found: end
//│ ║  
//│ ║  l.11:	end ;;
//│ ╙──     	^^^
//│ res: err
//│ U max: 1, total: 5
//│ UERR 1 errors
//│ L: 0 [err ~ ([err] -> α43), err <: ([err] -> α43)]

module IntPrinter (X : PRINTABLE) = struct
  let print_twice x = X.print x; X.print x
end ;;
//│ [ERROR] Type `err` does not match `err -> _`
//│ 
//│	(err) ---> (err -> _)
//│ 
//│ ◉ (err) comes from
//│ │  - l.13 module IntPrinter (X : PRINTABLE) = struct
//││         ^^^^^^
//│ ▼ 
//│ ◉ (err -> _) comes from
//│    - l.13 module IntPrinter (X : PRINTABLE) = struct
//│          ^^^^^^
//│ [ERROR] Type `err` does not match `err -> _`
//│ 
//│	(err) ---> (err -> _)
//│ 
//│ ◉ (err) comes from
//│ │  - l.14   let print_twice x = X.print x; X.print x
//││                                          ^^^^^^^
//│ ▼ 
//│ ◉ (err -> _) comes from
//│    - l.14   let print_twice x = X.print x; X.print x
//│                                           ^^^^^^^
//│ [ERROR] Type `err` does not match `_ -> _`
//│ 
//│	(err) ---> (_ -> _)
//│ 
//│ ◉ (err) comes from
//│ │  - l.14   let print_twice x = X.print x; X.print x
//││                               ^^^^^^^
//│ ▼ 
//│ ◉ (_ -> _) comes from
//│    - l.14   let print_twice x = X.print x; X.print x
//│                                ^^^^^^^
//│ ╔══[ERROR] identifier not found: module
//│ ║  
//│ ║  l.13:	module IntPrinter (X : PRINTABLE) = struct
//│ ╙──     	^^^^^^
//│ ╔══[ERROR] identifier not found: IntPrinter
//│ ║  
//│ ║  l.13:	module IntPrinter (X : PRINTABLE) = struct
//│ ╙──     	       ^^^^^^^^^^
//│ ╔══[ERROR] identifier not found: X
//│ ║  
//│ ║  l.13:	module IntPrinter (X : PRINTABLE) = struct
//│ ╙──     	                   ^
//│ ╔══[ERROR] type identifier not found: PRINTABLE
//│ ║  
//│ ║  l.13:	module IntPrinter (X : PRINTABLE) = struct
//│ ╙──     	                       ^^^^^^^^^
//│ ╔══[ERROR] identifier not found: struct
//│ ║  
//│ ║  l.13:	module IntPrinter (X : PRINTABLE) = struct
//│ ╙──     	                                    ^^^^^^
//│ res: bool
//│ ╔══[ERROR] identifier not found: X.print
//│ ║  
//│ ║  l.14:	  let print_twice x = X.print x; X.print x
//│ ╙──     	                      ^^^^^^^
//│ print_twice: 'a -> 'b
//│ ╔══[ERROR] identifier not found: X.print
//│ ║  
//│ ║  l.14:	  let print_twice x = X.print x; X.print x
//│ ╙──     	                                 ^^^^^^^
//│ ╔══[ERROR] identifier not found: x
//│ ║  
//│ ║  l.14:	  let print_twice x = X.print x; X.print x
//│ ╙──     	                                         ^
//│ res: 'a
//│ ╔══[ERROR] identifier not found: end
//│ ║  
//│ ║  l.15:	end ;;
//│ ╙──     	^^^
//│ res: err
//│ U max: 1, total: 8
//│ UERR 3 errors
//│ L: 0 [err ~ ([α48'] -> α49'), err <: ([α48'] -> α49')]
//│ L: 0 [err ~ ([err] -> α50), err <: ([err] -> α50)]
//│ L: 0 [err ~ ([err] -> α46), err <: ([err] -> α46)]

let main () =
  let module P = IntPrinter(PrintableInt) in
  P.print_twice true ;;
//│ [ERROR] Type `err` does not match `bool -> _`
//│ 
//│	(err) ---> (bool -> _)
//│ 
//│ ◉ (err) comes from
//│ │  - l.19   P.print_twice true ;;
//││           ^^^^^^^^^^^^^
//│ ▼ 
//│ ◉ (bool -> _) comes from
//│    - l.19   P.print_twice true ;;
//│            ^^^^^^^^^^^^^
//│ [ERROR] Type `err` does not match `err -> _`
//│ 
//│	(err) ---> (err -> _)
//│ 
//│ ◉ (err) comes from
//│ │  - l.18   let module P = IntPrinter(PrintableInt) in
//││                          ^^^^^^^^^^
//│ ▼ 
//│ ◉ (err -> _) comes from
//│    - l.18   let module P = IntPrinter(PrintableInt) in
//│                           ^^^^^^^^^^
//│ ╔══[ERROR] identifier not found: P
//│ ║  
//│ ║  l.18:	  let module P = IntPrinter(PrintableInt) in
//│ ╙──     	             ^
//│ ╔══[ERROR] identifier not found: IntPrinter
//│ ║  
//│ ║  l.18:	  let module P = IntPrinter(PrintableInt) in
//│ ╙──     	                 ^^^^^^^^^^
//│ ╔══[ERROR] identifier not found: PrintableInt
//│ ║  
//│ ║  l.18:	  let module P = IntPrinter(PrintableInt) in
//│ ╙──     	                           ^^^^^^^^^^^^^^
//│ ╔══[ERROR] identifier not found: P.print_twice
//│ ║  
//│ ║  l.19:	  P.print_twice true ;;
//│ ╙──     	  ^^^^^^^^^^^^^
//│ main: () -> 'a
//│ U max: 1, total: 2
//│ UERR 2 errors
//│ L: 0 [err ~ ([bool] -> α52'), err <: ([bool] -> α52')]
//│ L: 0 [err ~ ([err] -> α51''), err <: ([err] -> α51'')] 